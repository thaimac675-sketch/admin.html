<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Admin Panel - THAIPP</title>
    <style>
        body { font-family: sans-serif; background: #f1f5f9; padding: 20px; }
        .admin-container { max-width: 1000px; margin: auto; display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .box { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 20px; }
        h2 { color: #e11d48; border-bottom: 2px solid #f1f5f9; padding-bottom: 10px; margin-top: 0; font-size: 18px; }
        input, select { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        button { padding: 10px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; color: white; }
        .btn-blue { background: #2563eb; width: 100%; }
        .btn-green { background: #16a34a; width: 100%; }
        .btn-red { background: #e11d48; padding: 5px 10px; font-size: 11px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 13px; }
        th, td { border: 1px solid #eee; padding: 10px; text-align: left; }
        th { background: #f8fafc; }
        .scroll { max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>

<div class="admin-container">
    <div class="box">
        <h2>üì¶ ƒêƒÇNG ACC M·ªöI</h2>
        <input type="text" id="t" placeholder="Ti√™u ƒë·ªÅ">
        <input type="text" id="img" placeholder="T√™n ·∫£nh (vd: 1.jpg)">
        <input type="number" id="tg" placeholder="S·ªë t∆∞·ªõng">
        <input type="number" id="sk" placeholder="S·ªë trang ph·ª•c">
        <input type="number" id="pr" placeholder="Gi√° b√°n">
        <select id="cat">
            <option value="50">D∆∞·ªõi 50k</option>
            <option value="150">D∆∞·ªõi 150k</option>
            <option value="500">D∆∞·ªõi 500k</option>
            <option value="2000">D∆∞·ªõi 2M</option>
        </select>
        <input type="text" id="tk_acc" placeholder="T√†i kho·∫£n Game">
        <input type="text" id="mk_acc" placeholder="M·∫≠t kh·∫©u Game">
        <button class="btn-blue" onclick="saveAcc()">ƒêƒÇNG L√äN SHOP</button>
    </div>

    <div class="box">
        <h2>üí∞ C·ªòNG TI·ªÄN NHANH</h2>
        <input type="text" id="user_target" placeholder="T√™n t√†i kho·∫£n kh√°ch">
        <input type="number" id="amount" placeholder="S·ªë ti·ªÅn c·ªông">
        <button class="btn-green" onclick="addMoney()">C·ªòNG TI·ªÄN</button>
        
        <h2 style="margin-top:20px;">üì• DUY·ªÜT TH·∫∫ N·∫†P</h2>
        <div id="admin-card-list" class="scroll"></div>
    </div>

    <div class="box" style="grid-column: span 2;">
        <h2>üë• QU·∫¢N L√ù TH√ÄNH VI√äN (USER)</h2>
        <div class="scroll">
            <table>
                <thead>
                    <tr>
                        <th>T√†i kho·∫£n</th>
                        <th>M·∫≠t kh·∫©u</th>
                        <th>S·ªë d∆∞</th>
                        <th>Ng√†y t·∫°o</th>
                        <th>H√†nh ƒë·ªông</th>
                    </tr>
                </thead>
                <tbody id="user-list-admin"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    // --- QU·∫¢N L√ù USER ---
    function showUsersAdmin() {
        const users = JSON.parse(localStorage.getItem("all_users") || "[]");
        const container = document.getElementById("user-list-admin");
        container.innerHTML = "";
        
        users.reverse().forEach((u, index) => {
            const bal = localStorage.getItem("balance_" + u.username) || "0";
            container.innerHTML += `
                <tr>
                    <td><b>${u.username}</b></td>
                    <td>${u.password}</td>
                    <td style="color:green; font-weight:bold;">${parseInt(bal).toLocaleString()}ƒë</td>
                    <td style="color:#666;">${u.date || 'N/A'}</td>
                    <td><button class="btn-red" onclick="deleteUser('${u.username}')">X√≥a</button></td>
                </tr>`;
        });
    }

    function deleteUser(username) {
        if(confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a t√†i kho·∫£n [" + username + "]? M·ªçi d·ªØ li·ªáu ti·ªÅn v√† l·ªãch s·ª≠ s·∫Ω b·ªã m·∫•t!")) {
            // X√≥a kh·ªèi danh s√°ch user
            let users = JSON.parse(localStorage.getItem("all_users") || "[]");
            users = users.filter(u => u.username !== username);
            localStorage.setItem("all_users", JSON.stringify(users));
            
            // X√≥a s·ªë d∆∞ v√† c√°c d·ªØ li·ªáu li√™n quan
            localStorage.removeItem("balance_" + username);
            localStorage.removeItem("history_" + username);
            
            alert("ƒê√£ x√≥a t√†i kho·∫£n th√†nh c√¥ng!");
            showUsersAdmin(); // C·∫≠p nh·∫≠t l·∫°i b·∫£ng
        }
    }

    // --- QU·∫¢N L√ù ACC ---
    function saveAcc() {
        const acc = {
            id: Date.now(),
            title: document.getElementById('t').value,
            img: document.getElementById('img').value,
            tuong: document.getElementById('tg').value,
            skin: document.getElementById('sk').value,
            price: document.getElementById('pr').value,
            cat: document.getElementById('cat').value,
            tk: document.getElementById('tk_acc').value,
            mk: document.getElementById('mk_acc').value
        };
        if(!acc.title || !acc.tk) return alert("Nh·∫≠p ƒë·ªß th√¥ng tin!");
        let list = JSON.parse(localStorage.getItem("shop_accs") || "[]");
        list.push(acc);
        localStorage.setItem("shop_accs", JSON.stringify(list));
        alert("ƒê√£ ƒëƒÉng Acc!");
        location.reload();
    }

    // --- QU·∫¢N L√ù TH·∫∫ & TI·ªÄN ---
    function addMoney() {
        const user = document.getElementById('user_target').value.trim();
        const money = parseInt(document.getElementById('amount').value);
        if(!user || isNaN(money)) return alert("Nh·∫≠p ƒë·ªß th√¥ng tin!");
        let bal = parseInt(localStorage.getItem("balance_" + user) || "0");
        localStorage.setItem("balance_" + user, bal + money);
        alert("ƒê√£ c·ªông ti·ªÅn!");
        showUsersAdmin();
    }

    function showCardsAdmin() {
        const cards = JSON.parse(localStorage.getItem("all_cards") || "[]");
        const container = document.getElementById("admin-card-list");
        const pending = cards.filter(c => c.status == 0);
        if(pending.length === 0) { container.innerHTML = "Kh√¥ng c√≥ th·∫ª ch·ªù."; return; }
        pending.forEach(c => {
            container.innerHTML += `
                <div style="background:#f8fafc; padding:10px; margin-bottom:5px; border:1px solid #ddd; border-radius:5px;">
                    <b>${c.user}</b>: ${c.telco} - ${parseInt(c.amount).toLocaleString()}ƒë<br>
                    <small>S: ${c.serial} | P: ${c.pin}</small><br>
                    <button onclick="approve(${c.id}, 1)" style="background:green; color:white; border:none; padding:5px; margin-top:5px; border-radius:3px;">Duy·ªát</button>
                    <button onclick="approve(${c.id}, 2)" style="background:red; color:white; border:none; padding:5px; margin-top:5px; border-radius:3px;">Sai</button>
                </div>`;
        });
    }

    function approve(id, status) {
        let cards = JSON.parse(localStorage.getItem("all_cards") || "[]");
        let card = cards.find(c => c.id == id);
        if(card) {
            card.status = status;
            if(status == 1) {
                let bal = parseInt(localStorage.getItem("balance_" + card.user) || "0");
                localStorage.setItem("balance_" + card.user, bal + parseInt(card.amount));
            }
            localStorage.setItem("all_cards", JSON.stringify(cards));
            location.reload();
        }
    }

    // --- KH·ªûI CH·∫†Y ---
    window.onload = function() {
        showUsersAdmin();  // Hi·ªÉn th·ªã danh s√°ch user ngay khi v√†o trang
        showCardsAdmin();  // Hi·ªÉn th·ªã danh s√°ch th·∫ª n·∫°p
    };
</script>
</body>
</html>
